var HLH=function(){var f,b=0,m=new THREE.Euler(0,0,0,"YXZ"),h=new THREE.Euler(0,0,0,"YXZ");startAll=function(){HLH.startModel(HL.models[HL.modelsKeys[Math.floor(Math.random()*HL.modelsKeys.length)]],THREE.Math.randInt(-HLE.WORLD_WIDTH/4,HLE.WORLD_WIDTH/4),THREE.Math.randInt(.4*HLE.WORLD_HEIGHT,3*HLE.WORLD_HEIGHT),.1,"xyz")};startGroup=function(a,e,b,k,g,d,c){a.length&&(e=a[1],b=a[2],k=a[3],g=a[4],d=a[5]||0,c=a[6],a=a[0]);a="object"===typeof a?a:HL.mGroups[a];HLH.startModel(HL.models[a[Math.floor(Math.random()*
a.length)]],THREE.Math.randInt(-HLE.WORLD_WIDTH/4,HLE.WORLD_WIDTH/4),g?d:THREE.Math.randInt(.01*-HLE.WORLD_HEIGHT,1.1*HLE.WORLD_HEIGHT)+d,b,k,e,!1,c)};return{initBufParticleSystem:function(a,e,b,k,g){for(var d=[],c=0;c<k;c++)g?d.push([Math.random()*e-e/2,THREE.Math.randInt(.5*b,1.5*b),Math.random()*e-e/2]):d.push([Math.random()*e,10*e,Math.random()*e]);e=new Float32Array(3*d.length);for(var c=0;c<d.length;c++)e[3*c+0]=d[c][0],e[3*c+1]=d[c][1],e[3*c+2]=d[c][2];a.addAttribute("position",new THREE.BufferAttribute(e,
3))},loopParticles:function(a,b,l){for(f=0;f<a.attributes.position.array.length;f+=3)a.attributes.position.array[f+2]>1.5*-b&&(a.attributes.position.array[f+2]+=Math.abs(1.1*l)),a.attributes.position.array[f+2]>=1.5*b&&(a.attributes.position.array[f]=(2*Math.random()-1)*b/2,a.attributes.position.array[f+2]=1.5*-b+.1);a.attributes.position.needsUpdate=!0},resetModel:function(a){a.position.set(0,0,10*-HLE.WORLD_WIDTH);a.moving=!1},resetAllModels:function(){for(var a in HL.models)null!==HL.models[a]&&
HL.models[a].position.set(0,0,10*-HLE.WORLD_WIDTH)},startModel:function(a,e,l,k,g,d,c,f){d=d||1;c=void 0!==c?c:!1;a=HL.models[a]||a;f=void 0===f?!0:f;c&&HLE.PARTICLE_MODELS_OUT++;if(!(HL.dynamicModelsClones.length>=HLE.MAX_MODELS_OUT+HLE.PARTICLE_MODELS_OUT)){b++;k=k||0;var h=e||0;l=l||0;g=g||"n";HL.dynamicModelsClones["m"+b]=a.clone();m.setFromQuaternion(HL.cameraGroup.quaternion,"YXZ");HL.dynamicModelsClones["m"+b].srv=m;var n=-HLE.WORLD_WIDTH/2;f&&(h=Math.sin(m.y+e/HLE.WORLD_WIDTH)*n,n*=Math.cos(m.y+
e/HLE.WORLD_WIDTH),HL.dynamicModelsClones["m"+b].rotateY(m.y));!0===l&&(k=l=0,0!=l&&(HL.dynamicModelsClones["m"+b].rotateX(3*(Math.random()-.5)),HL.dynamicModelsClones["m"+b].rotateY(3*(Math.random()-.5)),HL.dynamicModelsClones["m"+b].rotateZ(3*(Math.random()-.5))));-1!=g.indexOf("x")&&HL.dynamicModelsClones["m"+b].rotateX(3*(Math.random()-.5));-1!=g.indexOf("y")&&HL.dynamicModelsClones["m"+b].rotateY(3*(Math.random()-.5));-1!=g.indexOf("z")&&HL.dynamicModelsClones["m"+b].rotateZ(3*(Math.random()-
.5));HL.dynamicModelsClones["m"+b].size=a.size;HL.dynamicModelsClones["m"+b].size.multiplyScalar(d);HL.dynamicModelsClones["m"+b].scale.set(.7+.3*Math.random()+d,.7+.3*Math.random()+d,.7+.3*Math.random()+d);HL.dynamicModelsClones["m"+b].key="m"+b;HL.scene.add(HL.dynamicModelsClones["m"+b]);c&&(HL.dynamicModelsClones["m"+b].isparticle=!0);HL.dynamicModelsClones.length++;HL.dynamicModelsClones["m"+b].position.set(h,l,n);HL.dynamicModelsClones["m"+b].speed=k;HL.dynamicModelsClones["m"+b].targetY=l;HL.dynamicModelsClones["m"+
b].moving=!0;HL.dynamicModelsClones["m"+b].rotations=g;HL.dynamicModelsClones["m"+b].towardsCamera=f}},startGroup:function(a,b,f,k,g,d,c,h){startGroup(a,b,f,k,g,d,c,h)},moveModel:function(a,b){h.setFromQuaternion(HL.cameraGroup.quaternion,"YXZ");h.x=Math.sin(h.y);h.z=Math.cos(h.y);a.srv.x=Math.sin(a.srv.y);a.srv.z=Math.cos(a.srv.y);a.position.x>=-HLE.WORLD_WIDTH/2&&a.position.z>=-HLE.WORLD_WIDTH/2&&(a.position.x+=h.x*HLE.moveSpeed,a.position.z+=h.z*HLE.moveSpeed,a.towardsCamera?(a.position.x+=a.srv.x*
a.speed,a.position.z+=a.srv.z*a.speed):a.position.z+=a.speed,-1!=a.rotations.indexOf("x")&&a.rotateX(7.5E-4*Math.max(a.speed,1)),-1!=a.rotations.indexOf("y")&&a.rotateY(7.5E-4*Math.max(a.speed,1)),-1!=a.rotations.indexOf("z")&&a.rotateZ(7.5E-4*Math.max(a.speed,1)),a.position.y==HL.sea.position.y&&(a.rotation.x=.3*Math.cos(.003*frameCount)*Math.sin(.003*frameCount),a.rotation.y=.3*Math.sin(.003*frameCount)*Math.cos(.003*frameCount),a.rotation.z=.3*Math.cos(.003*frameCount)),a.dist=a.position.distanceTo(HL.camera.position),
a.dist=Math.min(a.dist/HLE.WORLD_WIDTH,1),a.dist=Math.pow(1-a.dist,10),a.dist=a.speed*a.dist*.05*Math.min(3E-4*a.size.length(),.001),HL.camera.rotation.x+=THREE.Math.randFloat(-1,1)*a.dist,HL.camera.rotation.y+=THREE.Math.randFloat(-1,1)*a.dist,HL.camera.rotation.z+=THREE.Math.randFloat(-1,1)*a.dist);HL.camera.rotation.x*=.98;HL.camera.rotation.y*=.98;HL.camera.rotation.z*=.98;if(a.position.x>HLE.WORLD_WIDTH/2||a.position.x<-HLE.WORLD_WIDTH/2||a.position.z>HLE.WORLD_WIDTH/2||a.position.z<-HLE.WORLD_WIDTH/
2)HL.scene.remove(a),a.material.dispose(),a.geometry.dispose(),delete HL.dynamicModelsClones[a.key],HL.dynamicModelsClones.length--,HL.camera.rotation.x=0,HL.camera.rotation.y=0,HL.camera.rotation.z=0},destroyAllModels:function(){for(var a in HL.dynamicModelsClones)-1===a.indexOf("length")&&(HL.scene.remove(HL.dynamicModelsClones[a]),HL.dynamicModelsClones[a].material.dispose(),HL.dynamicModelsClones[a].geometry.dispose(),delete HL.dynamicModelsClones[a]);HL.dynamicModelsClones.length=0},startAll:startAll}}();
