var STATUS={};STATUS.CARDBOARD=-1<window.location.href.indexOf("?cardboard");STATUS.VR=-1<window.location.href.indexOf("?vr");STATUS.FPC=-1<window.location.href.indexOf("?fpc");STATUS.WIREFRAME=-1<window.location.href.indexOf("?wireframe");STATUS.MAPPED=-1<window.location.href.indexOf("?mapped");STATUS.NOSOCKET=-1<window.location.href.indexOf("?nosocket");STATUS.REMIDI=-1<window.location.href.indexOf("?remidi");STATUS.FBO=-1<window.location.href.indexOf("?fbo");STATUS.ISVISUAL=-1<window.location.href.indexOf("?visual");
STATUS.FORCEEFFECTS=-1<window.location.href.indexOf("?forceefffects");function getMobileOperatingSystem(){var a=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(a)?"Windows Phone":/android/i.test(a)?"Android":/iPad|iPhone|iPod/.test(a)&&!window.MSStream?"iOS":"unknown"}STATUS.MOBILEOS=getMobileOperatingSystem();STATUS.ISMOBILE=!1;-1==STATUS.MOBILEOS.indexOf("unknown")&&(STATUS.ISMOBILE=!0);var SOCKETSERVER="https://exalandsocket.spime.im",noSleep=new NoSleep;
HLMain={};var frameCount=0,millis=0,delta=0;
function mainInit(){(new NoScroll).enable();window.addEventListener("resize",function(){HL.camera.aspect=window.innerWidth/window.innerHeight;HL.camera.updateProjectionMatrix();HL.cameraCompanion.regenerateGeometry();HL.renderer.setSize(window.innerWidth,window.innerHeight);STATUS.CARDBOARD&&HL.stereoEffect.setSize(window.innerWidth,window.innerHeight);HLE.WATER&&HL.materials.water.renderer.setSize(window.innerWidth,window.innerHeight);HLE.MIRROR&&HL.materials.mirror.renderer.setSize(window.innerWidth,window.innerHeight);
STATUS.FPC&&HL.controls.handleResize()});AA=STATUS.ISVISUAL?new AAMS:{}}var performanceLow=0,performanceHigh=0;
function mainLoop(){HLMain.rafID=STATUS.VR?HL.VREffect.requestAnimationFrame(mainLoop):window.requestAnimationFrame(mainLoop);frameCount++;millis=frameCount/60;delta=HL.clock.getDelta();HLE.MIRROR||HLE.WATER||HLAnim.sea();HLE.MIRROR&&HLAnim.mirrorWaves();HLE.WATER&&HLAnim.seaGLSL();HLAnim.landGLSL();HLAnim.models();HLAnim.particles();STATUS.ISMOBILE||STATUS.VR||STATUS.REMIDI?HL.controls.update():STATUS.FPC&&HL.controls.update(delta);STATUS.FORCEEFFECTS&&(HLR.randomizeTrigger=!0,HLR.textTrigger=!0,
HLR.objectsTrigger=!0,HLR.glitchEffect=!0);HLE.WATER&&HL.materials.water.render();HLE.MIRROR&&HL.materials.mirror.render();STATUS.FBO||1==HLR.glitchEffect?(STATUS.CARDBOARD?(HL.stereoEffect.render(HL.scene,HL.camera,HL.glitchFBO),HL.renderer.crop(0,0,.5*window.innerWidth,window.innerHeight),HL.renderer.render(HL.glitchScene,HL.glitchCamera),HL.renderer.crop(.5*window.innerWidth,0,.5*window.innerWidth,window.innerHeight)):HL.renderer.render(HL.scene,HL.camera,HL.glitchFBO),HL.renderer.render(HL.glitchScene,
HL.glitchCamera)):STATUS.CARDBOARD?HL.stereoEffect.render(HL.scene,HL.camera):HL.renderer.render(HL.scene,HL.camera);delta=null}var setVisibility=function(a,d){for(var c=document.querySelectorAll(a),b=0;b<c.length;b++)c[b].style.opacity=d?1:0,c[b].style.display=d?"block":"none"};
HLMain.updateStatus=function(a){20==a&&(HLR.PREVGAMESTATUS=HLR.GAMESTATUS);HLR.GAMESTATUS=-1==a?HLR.PREVGAMESTATUS:a;switch(HLR.GAMESTATUS){case 0:setVisibility(".screens",!1);setVisibility("#loading",!0);STATUS.ISVISUAL&&AA.pause();break;case 10:STATUS.ISVISUAL&&AA.getSelectedSource()!=AA.FILE&&AA.connectMic();HLMain.play();STATUS.ISVISUAL&&AA.play();setVisibility(".screens",!1);break;case 11:STATUS.ISVISUAL&&AA.getSelectedSource()!=AA.MIC&&AA.connectMic();HLMain.play();STATUS.ISVISUAL&&AA.play();
setVisibility(".screens",!1);break;case 12:HLMain.play();setVisibility(".screens",!1);break;case 20:HLMain.pause();setVisibility(".screens",!1);setVisibility("#paused",!0);STATUS.ISVISUAL&&AA.pause();break;case 30:setVisibility(".screens",!1),setVisibility("#ended",!0)}};
HLMain.screensInit=function(){HL.modelsLoadingManager.onProgress=function(a,d,c){a="";for(var b=0;b<100/c*d;b++)a+="#";document.getElementById("modelsLoading").innerHTML=a};HL.texturesLoadingManager.onProgress=function(a,d,c){a="";for(var b=0;b<100/c*d;b++)a+="#";document.getElementById("texturesLoading").innerHTML=a}};var noSleepEnabled=!1;
window.addEventListener("HLEload",function(){var a=document.getElementById("startButton");a.disabled=!1;a.addEventListener("click",function(){noSleep.enable();HLMain.updateStatus(11)},!1);HL.renderer.domElement.addEventListener("touchstart",function(){noSleep.enable()})});
function loadRoutine(){HLR.init();mainInit();HLEnvironment.init();HLMain.screensInit();window.addEventListener("HLEload",function(){console.log("event HLEload received")});STATUS.VR&&!0===WEBVR.isAvailable()&&document.body.appendChild(WEBVR.getButton(HL.VREffect));window.removeEventListener("load",loadRoutine)}window.addEventListener("load",loadRoutine,!1);HLMain.rafID=null;HLMain.pause=function(){HL.clock.stop();window.cancelAnimationFrame(HLMain.rafID);HLMain.rafID=null};
HLMain.play=function(){null===HLMain.rafID&&(HL.clock.start(),mainLoop())};
