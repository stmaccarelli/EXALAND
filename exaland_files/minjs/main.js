var isCardboard=-1<window.location.href.indexOf("?cardboard"),isVR=-1<window.location.href.indexOf("?webvr"),isDebug=-1<window.location.href.indexOf("?debug"),isFPC=-1<window.location.href.indexOf("?fpc"),isOrbit=-1<window.location.href.indexOf("?orbit"),isNoiseCam=-1<window.location.href.indexOf("?noisecam"),isWire=-1<window.location.href.indexOf("?wire"),hasShadows=!1,noHUD=-1<window.location.href.indexOf("?noHUD"),isMapped=-1<window.location.href.indexOf("?mapped"),mappingCorrectAspect=-1<window.location.href.indexOf("?mappedB"),
staticAudio=-1<window.location.href.indexOf("?staticaudio"),noSocket=-1<window.location.href.indexOf("?nosocket"),partSocket=-1<window.location.href.indexOf("?partsocket"),hasGUI=-1<window.location.href.indexOf("?gui"),midiIn=-1<window.location.href.indexOf("?midiin"),remidi=-1<window.location.href.indexOf("?remidi"),useFBO=-1<window.location.href.indexOf("?fbo"),noSleep=new NoSleep,isVisual=-1<window.location.href.indexOf("?visual"),SOCKETSERVER="https://exalandsocket.spime.im",mobileOS=function(){var a=
navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(a)?"Windows Phone":/android/i.test(a)?"Android":/iPad|iPhone|iPod/.test(a)&&!window.MSStream?"iOS":"unknown"}(),isMobile=!1;-1==mobileOS.indexOf("unknown")&&(isMobile=!0);var frameCount=0,millis=0,delta=0;HLMain={};
function mainInit(){(new NoScroll).enable();window.addEventListener("resize",function(){HL.camera.aspect=window.innerWidth/window.innerHeight;HL.camera.updateProjectionMatrix();HL.cameraCompanion.regenerateGeometry();HL.renderer.setSize(window.innerWidth,window.innerHeight);isCardboard&&HL.stereoEffect.setSize(window.innerWidth,window.innerHeight);HLE.WATER&&HL.materials.water.renderer.setSize(window.innerWidth,window.innerHeight);HLE.MIRROR&&HL.materials.mirror.renderer.setSize(window.innerWidth,
window.innerHeight);isFPC&&HL.controls.handleResize()});AA=isVisual?new AAMS:{}}var performanceLow=0,performanceHigh=0;
function mainLoop(){HLMain.rafID=isVR?HL.VREffect.requestAnimationFrame(mainLoop):window.requestAnimationFrame(mainLoop);frameCount++;millis=frameCount/60;delta=HL.clock.getDelta();HLE.MIRROR||HLE.WATER||HLAnim.sea();HLE.MIRROR&&HLAnim.mirrorWaves();HLE.WATER&&HLAnim.seaGLSL();HLAnim.landGLSL();HLAnim.models();HLAnim.particles();isMobile||isOrbit||isVR||remidi?HL.controls.update():(isFPC||isNoiseCam)&&HL.controls.update(delta);HLE.WATER&&HL.materials.water.render();HLE.MIRROR&&HL.materials.mirror.render();
isCardboard||isVR?((HLE.MIRROR||HLE.WATER)&&HL.renderer.setRenderTarget(null),isCardboard&&HL.stereoEffect.render(HL.scene,HL.camera),isVR&&HL.VREffect.render(HL.scene,HL.camera)):isMapped?(HL.renderer.render(HL.scene,HL.camera,HL.mappingRenderTarget),HL.renderer.render(HL.mappingScene,HL.mappingCamera)):useFBO||1==HLR.glitchEffect?(HL.renderer.render(HL.scene,HL.camera,HL.glitchFBO),HL.renderer.render(HL.glitchScene,HL.glitchCamera)):HL.renderer.render(HL.scene,HL.camera);delta=null}
var setVisibility=function(a,d){for(var c=document.querySelectorAll(a),b=0;b<c.length;b++)c[b].style.opacity=d?1:0,c[b].style.display=d?"block":"none"};
HLMain.updateStatus=function(a){20==a&&(HLR.PREVGAMESTATUS=HLR.GAMESTATUS);HLR.GAMESTATUS=-1==a?HLR.PREVGAMESTATUS:a;switch(HLR.GAMESTATUS){case 0:setVisibility(".screens",!1);setVisibility("#loading",!0);isVisual&&AA.pause();break;case 10:isVisual&&AA.getSelectedSource()!=AA.FILE&&AA.connectMic();HLMain.play();isVisual&&AA.play();setVisibility(".screens",!1);break;case 11:isVisual&&AA.getSelectedSource()!=AA.MIC&&AA.connectMic();HLMain.play();isVisual&&AA.play();setVisibility(".screens",!1);break;
case 12:HLMain.play();setVisibility(".screens",!1);break;case 20:HLMain.pause();setVisibility(".screens",!1);setVisibility("#paused",!0);isVisual&&AA.pause();break;case 30:setVisibility(".screens",!1),setVisibility("#ended",!0)}};
HLMain.screensInit=function(){HL.modelsLoadingManager.onProgress=function(a,d,c){a="";for(var b=0;b<100/c*d;b++)a+="#";document.getElementById("modelsLoading").innerHTML=a};HL.texturesLoadingManager.onProgress=function(a,d,c){a="";for(var b=0;b<100/c*d;b++)a+="#";document.getElementById("texturesLoading").innerHTML=a}};var noSleepEnabled=!1;
window.addEventListener("HLEload",function(){var a=document.getElementById("startButton");a.disabled=!1;a.addEventListener("click",function(){noSleep.enable();HLMain.updateStatus(11)},!1);HL.renderer.domElement.addEventListener("touchstart",function(){noSleep.enable()})});
function loadRoutine(){HLR.init();mainInit();HLEnvironment.init();HLMain.screensInit();window.addEventListener("HLEload",function(){console.log("event HLEload received");hasGUI&&(G=GUI(),G.guiInit())});isVR&&!0===WEBVR.isAvailable()&&document.body.appendChild(WEBVR.getButton(HL.VREffect));window.removeEventListener("load",loadRoutine)}window.addEventListener("load",loadRoutine,!1);HLMain.rafID=null;HLMain.pause=function(){HL.clock.stop();window.cancelAnimationFrame(HLMain.rafID);HLMain.rafID=null};
HLMain.play=function(){null===HLMain.rafID&&(HL.clock.start(),mainLoop())};
